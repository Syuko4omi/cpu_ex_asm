# アセンブラ
アセンブリ言語（RISC-V）で書かれたファイルをバイナリファイルに変換する。

## 実行方法
```
make
./asm.sh
"filename"
```

元のファイル（filenameの部分）は.sでも.txtでもok。バイナリファイルへの変換が一気に行われてoutput.binが生成される。

## 注意
読ませるアセンブリの（テキスト）ファイルは、最終行を改行すること。これがないと最終行が読み取られないまま出力されてしまう。

## パーツの説明
### 実行ファイル（.asm）

```
./asm "filename"
```
ファイル名（.sもしくは.txt）をつけなければ標準入力から読む。ctrl+Dで終了を通知すると変換される。
アセンブリは指定がなければstdoutに出力(16進数表示)。適宜リダイレクション等で.txtファイルに入れてあげる。  
この時点では擬似命令laが入っている場合などに対応できないので、必ず以下のpreprocess.pyで前処理をしてから実行すること。

### バイナリ変換（txt_to_bin.py）
例えば、各行に16進数命令が書かれたhoge.txtを実際のバイナリに変換するには、
```
python txt_to_bin.py hoge.txt hoge.bin
```
とすればよい。

### 擬似命令li/laの分解、jmp系命令のラベル解決、インデントの整形（preprocess.py）

```
python preprocess.py hoge.txt
```
li/la命令をlui,addiに分解した機械語を生成する。la (reg), (label)となっている（即値としてラベルが埋め込まれている）場合は、ここで解決する。  
jmp系の命令のラベルが整数（pcの差分）になっている場合も解決する。

### デバッグ用アセンブリコード生成（fixed_lui.py）
lui命令の即値を4096倍したアセンブリコードを生成する。  
（注意: これにより生成されたfor_debug.sはアセンブラにかけても読み取られない。）

# アセンブラ
アセンブリ言語（RISC-V）で書かれたファイルをバイナリファイルに変換する。

## 実行方法
```
make
./asm.sh
"filename"
```

元のファイル（filenameの部分）は.sでも.txtでもok。バイナリファイルへの変換が一気に行われてoutput.binが生成される。

## 注意
読ませるアセンブリの（テキスト）ファイルは、最終行を改行すること。これがないと最終行が読み取られないまま出力されてしまう。

## パーツの説明
### 実行ファイル（.asm）

```
./asm "filename"
```
ファイル名（.sもしくは.txt）をつけなければ標準入力から読む。ctrl+Dで終了を通知すると変換される。
アセンブリは指定がなければstdoutに出力(16進数表示)。適宜リダイレクション等で.txtファイルに入れてあげる。  
この時点では擬似命令laが入っている場合に対応できないので、もしファイル中でlaを使いたければ以下の「擬似命令li/laの分解」を行ってからにすること。

### バイナリ変換（txt_to_bin.py）
例えば、各行に16進数命令が書かれたhoge.txtを実際のバイナリに変換するには、
```
python txt_to_bin.py hoge.txt hoge.bin
```
とすればよい。

### 擬似命令li、もしくはlaの分解（preprocess.py）
li/la命令をlui,addiに分解した機械語を生成する。la (reg), (label)となっている（即値としてラベルが埋め込まれている）場合は、ここで解決する。  
  
現状、ラベル名は左詰めで、オペコード+オペランド2つの行は
```
\t(opcode)\t(operand), (operand)\n
```
オペコード+オペランド3つの行は
```
\t(opcode)\t(operand), (operand), (operand)\n
```
のみを受け付ける実装になっているので、このフォーマットに沿わないものは弾かれてしまうため注意が必要（もし変える必要性が出てきたら検討します）。出力もこのフォーマットに合わせている。  

ひとまず、このリポジトリ中のack.sなどは受け付けるようになっている。